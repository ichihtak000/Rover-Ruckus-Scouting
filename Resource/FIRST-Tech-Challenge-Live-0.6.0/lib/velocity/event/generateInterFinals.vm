## Copyright (c) 2018 FIRST, Thomas Barnette, George Marchant, and Trey Woodlief. All rights reserved.
##
## Redistribution and use in source and binary forms, with or without modification,
## are permitted (subject to the limitations in the disclaimer below) provided that
## the following conditions are met:
##
## Redistributions of source code must retain the above copyright notice, this list
## of conditions and the following disclaimer.
##
## Redistributions in binary form must reproduce the above copyright notice, this
## list of conditions and the following disclaimer in the documentation and/or
## other materials provided with the distribution.
##
## Neither the name of FIRST nor the names of its contributors may be used to endorse or
## promote products derived from this software without specific prior written permission.
##
## NO EXPRESS OR IMPLIED LICENSES TO ANY PARTY'S PATENT RIGHTS ARE GRANTED BY THIS
## LICENSE. THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
## "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO,
## THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
## ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE
## FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
## DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR
## SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
## CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
## OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
## OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
##

#parse("/velocity/layout.vm")
#@mainLayout()
<style>
table {
width:100%;
}
</style>
<script>
var divisions=[
	#foreach($division in $divisions)
		#if($division.getEvent().getFinals())
			#set($winner = $division.getEvent().getFinals().getWinner())
		#end
		#if(!$winner) ##need to import
			null,
		#else
			{
				seed:"$winner.getSeed()",
				team1:"$winner.getTeam1Number()",
				team2:"$winner.getTeam2Number()",
				team3:#if($winner.getTeam3Number() > 0)"$winner.getTeam3Number()"#{else}"---"#end,
				carriesCard:#if($winner.getCardCarries1().size()>0)"Yes"#{else}"No"#end
			},
		#end
	#end
];
function uploadDivision(){
	var files = document.getElementById("divisionFile").files;
	var formData = new FormData();
	formData.append("file",files[0], files[0].name);
	
	$.ajax({
       url : '',##TODO
       type : 'POST',
       data : formData,
       processData: false,  // tell jQuery not to process the data
       contentType: false,  // tell jQuery not to set contentType
       success : function(data) {
          // preview the logo using the name we got back
          $("#divisionPath").text(data);
       },
       fail : function(xhr, textStatus, error){
		  
		}
	});
}
function showAlliance(alliance) {
	var division = $("#" + alliance + "AllianceInput").val();
	$("#" + alliance + "Seed").text(divisions[division].seed);
	$("#" + alliance + "1").text(divisions[division].team1);
	$("#" + alliance + "2").text(divisions[division].team2);
	$("#" + alliance + "3").text(divisions[division].team3);
	$("#" + alliance + "Carries").text(divisions[division].carriesCard);
	if ($("#redAllianceInput").val() == $("#blueAllianceInput").val()) {
		$("#submitButton").addClass("disabled");
		$("#submitButton").prop("disabled", true);
	} else {
		$("#submitButton").removeClass("disabled");
		$("#submitButton").prop("disabled", false);
	}
}
function submit() {
	o = {
			redDiv:$("#redAllianceInput").val(),
			blueDiv:$("#blueAllianceInput").val()
	}
	$.ajax({
	    url: '.',
	    type: 'POST',
	    data: o,
	    success: function (data,textStatus, xhr) {
	    	window.location.href = '..';
	    },
	    error: function(xhr, status, error){
	    
	    }
	});
}
$(document).ready(function(){
	showAlliance('red');
	showAlliance('blue');
});
</script>
<div class="row">
	<div class="col-12">
		<a href="../"><< Back to Dashboard</a>
	</div>
</div>
<div class="row justify-content-center">
	<h2 class=" text-center">Generate Inter-Division Finals</h2>
</div>
<br><br>
<div class="row">
	<div class="col-md-6 offset-md-3">
	#set($canCreate = true)
	#foreach ($division in $divisions)
		<div class="form-group">
			<label for="eventTypeInput" class="h4">$division.getName()</label>
			#if($division.getEvent().getFinals())
				#set($winner = $division.getEvent().getFinals().getWinner())
			#else
				#set($winner = false)			
			#end
			#if(!$winner) ##need to import
				#set($canCreate = false)
				<div class="form-group">
					<label for="divisionFile">Division Database:</label>
					<br>
					<input id="divisionFile" type="file" name="file"/>
					<button id="uploadDivision" onclick="uploadDivision()">Import Division</button>
				</div>
				<div>
					<small id="divisionPath"></small>
				</div>
			#else
				<table>
				<tr><th>Seed</th><th>Captain</th><th>First Pick</th><th>Second Pick</th><th>Carries Card?</th></tr>
				<tr><td>$winner.getSeed()</td><td>$winner.getTeam1Number()</td><td>$winner.getTeam2Number()</td><td>#if($winner.getTeam3Number() > 0)$winner.getTeam3Number()#{else}---#end</td><td>#if($winner.getCardCarries1().size()>0)&#x2713;#{else}&#x25A2;#end</td></tr>
				</table>
			#end
		</div>
	#end
	</div>
</div>
<div class="row">
	<div class="col-md-6 offset-md-3">
		<hr>
	</div>
</div>
<br>
<div class="row">
	<div class="col-md-6 offset-md-3">
		<div class="form-group">
			<label for="redAllianceInput" class="h4">Red Alliance:</label>
			<select class="custom-select" name="redAlliance" id="redAllianceInput" onchange="showAlliance('red')" #if(!$canCreate)class="disabled" disabled#end>
				#if($canCreate)
				#foreach ($division in $divisions)
					<option value="$foreach.index" #if(0 == $foreach.index)selected#end>$division.getName()</option>
				#end
				#else
					<option>Must have data for all divisions before selecting Alliances</option>
				#end
			</select>
			<br><br>
			#if($canCreate)
				<table>
				<tr><th>Seed</th><th>Captain</th><th>First Pick</th><th>Second Pick</th><th>Carries Card?</th></tr>
				<tr><td id="redSeed"></td><td id="red1"></td><td id="red2"></td><td id="red3"></td><td id="redCarries"></td></tr>
				</table>
			#else
				<table>
				<tr><th>Seed</th><th>Captain</th><th>First Pick</th><th>Second Pick</th><th>Carries Card?</th></tr>
				<tr><td>---</td><td>---</td><td>---</td><td>---</td><td>---</td></tr>
				</table>
			#end
		</div>
		<div class="form-group">
			<label for="blueAllianceInput" class="h4">Blue Alliance:</label>
			<select class="custom-select" name="blueAlliance" id="blueAllianceInput" onchange="showAlliance('blue')" #if(!$canCreate)class="disabled" disabled#end >
				#if($canCreate)
				#foreach ($division in $divisions)
					<option value="$foreach.index" #if(1 == $foreach.index)selected#end>$division.getName()</option>
				#end
				#else
					<option>Must have data for all divisions before selecting Alliances</option>
				#end
			</select>
			<br><br>
			#if($canCreate)
				<table>
				<tr><th>Seed</th><th>Captain</th><th>First Pick</th><th>Second Pick</th><th>Carries Card?</th></tr>
				<tr><td id="blueSeed"></td><td id="blue1"></td><td id="blue2"></td><td id="blue3"></td><td id="blueCarries"></td></tr>
				</table>
			#else
				<table>
				<tr><th>Seed</th><th>Captain</th><th>First Pick</th><th>Second Pick</th><th>Carries Card?</th></tr>
				<tr><td>---</td><td>---</td><td>---</td><td>---</td><td>---</td></tr>
				</table>
			#end
		</div>
		<div class="form-group">
			<br>
			<button class="btn btn-primary" id="submitButton" onclick="submit()" #if(!$canCreate)class="disabled" disabled#end>Generate Inter-Division Finals</button>
		</div>
	</div>
</div>
#end